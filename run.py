#!/usr/bin/env python3
"""
VK Data Assistant Bot
Ğ¢Ğ¾Ñ‡ĞºĞ° Ğ²Ñ…Ğ¾Ğ´Ğ° Ğ´Ğ»Ñ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ° Ğ±Ğ¾Ñ‚Ğ°
"""

import sys
import asyncio
import logging
from pathlib import Path

# Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ ĞºĞ¾Ñ€Ğ½ĞµĞ²ÑƒÑ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ² Ğ¿ÑƒÑ‚ÑŒ Python
sys.path.insert(0, str(Path(__file__).parent))

from bot.main import main
from services.logger_service import setup_logger

def setup_logging():
    """ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ"""
    # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ´Ğ»Ñ Ğ»Ğ¾Ğ³Ğ¾Ğ² ĞµÑĞ»Ğ¸ ĞµÑ‘ Ğ½ĞµÑ‚
    log_dir = Path("logs")
    log_dir.mkdir(exist_ok=True)

    # ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
    log_format = "%(asctime)s [%(levelname)s] %(name)s: %(message)s"
    date_format = "%Y-%m-%d %H:%M:%S"

    # ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ² Ñ„Ğ°Ğ¹Ğ»
    logging.basicConfig(
        level=logging.INFO,
        format=log_format,
        datefmt=date_format,
        handlers=[
            # Ğ’Ñ‹Ğ²Ğ¾Ğ´ Ğ² ĞºĞ¾Ğ½ÑĞ¾Ğ»ÑŒ
            logging.StreamHandler(sys.stdout),
            # Ğ—Ğ°Ğ¿Ğ¸ÑÑŒ Ğ² Ñ„Ğ°Ğ¹Ğ»
            logging.FileHandler(
                log_dir / "bot.log",
                mode='a',
                encoding='utf-8'
            )
        ]
    )

    # Ğ£Ğ¼ĞµĞ½ÑŒÑˆĞ°ĞµĞ¼ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ´Ğ»Ñ Ğ½ĞµĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ñ… Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞº
    logging.getLogger("aiogram").setLevel(logging.WARNING)
    logging.getLogger("telethon").setLevel(logging.WARNING)
    logging.getLogger("asyncio").setLevel(logging.WARNING)


def print_banner():
    """Ğ’Ñ‹Ğ²Ğ¾Ğ´ Ğ±Ğ°Ğ½Ğ½ĞµÑ€Ğ° Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ¿ÑƒÑĞºĞµ"""
    banner = """
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘        VK Data Assistant Bot             â•‘
â•‘        Version: 2.0                      â•‘
â•‘        Author: Your Team                 â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    """
    print(banner)


if __name__ == "__main__":
    # ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
    setup_logging()

    # Ğ’Ñ‹Ğ²Ğ¾Ğ´ Ğ±Ğ°Ğ½Ğ½ĞµÑ€Ğ°
    print_banner()

    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ logger
    logger = logging.getLogger("run")

    try:
        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ²ĞµÑ€ÑĞ¸Ğ¸ Python
        if sys.version_info < (3, 10):
            logger.error("Ğ¢Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ Python 3.10 Ğ¸Ğ»Ğ¸ Ğ²Ñ‹ÑˆĞµ!")
            sys.exit(1)

        logger.info("ğŸš€ Ğ—Ğ°Ğ¿ÑƒÑĞº VK Data Assistant Bot...")

        # Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ±Ğ¾Ñ‚Ğ°
        asyncio.run(main())

    except KeyboardInterrupt:
        logger.info("â¹ Ğ‘Ğ¾Ñ‚ Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¼")
        sys.exit(0)
    except Exception as e:
        logger.error(f"âŒ ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ°: {e}", exc_info=True)
        sys.exit(1)