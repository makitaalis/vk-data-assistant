# –õ–æ–≥–∏–∫–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ VK Data Assistant

## –û–ø–∏—Å–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

–°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å **–ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã** –∫ –±–æ—Ç—É-–ø–æ–∏—Å–∫–æ–≤–∏–∫—É –¥–ª—è —Å—Å—ã–ª–æ–∫, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –±—ã–ª–∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã —Ä–∞–Ω–µ–µ, –¥–∞–∂–µ –µ—Å–ª–∏ –ø–æ –Ω–∏–º –Ω–µ –±—ã–ª–∏ –Ω–∞–π–¥–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ.

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1. –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–∞ –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å—Å—ã–ª–æ–∫:

1. –°–∏—Å—Ç–µ–º–∞ –∏–∑–≤–ª–µ–∫–∞–µ—Ç –≤—Å–µ VK —Å—Å—ã–ª–∫–∏
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–∞–∂–¥—É—é —Å—Å—ã–ª–∫—É –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö PostgreSQL
3. –†–∞–∑–¥–µ–ª—è–µ—Ç —Å—Å—ã–ª–∫–∏ –Ω–∞ –¥–≤–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:
   - **–ò–∑ –∫–µ—à–∞** - —Å—Å—ã–ª–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –µ—Å—Ç—å –≤ –ë–î (—Å –¥–∞–Ω–Ω—ã–º–∏ –∏–ª–∏ –±–µ–∑)
   - **–ù–æ–≤—ã–µ** - —Å—Å—ã–ª–∫–∏, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ –ë–î

### 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:

- **–°—Å—ã–ª–∫–∏ –∏–∑ –∫–µ—à–∞** ‚Üí –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (–º–≥–Ω–æ–≤–µ–Ω–Ω–æ)
- **–ù–æ–≤—ã–µ —Å—Å—ã–ª–∫–∏** ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –±–æ—Ç—É –¥–ª—è –ø–æ–∏—Å–∫–∞

### 3. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î:

–í—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î, –≤–∫–ª—é—á–∞—è:
- ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å –Ω–∞–π–¥–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (—Ç–µ–ª–µ—Ñ–æ–Ω—ã, –∏–º–µ–Ω–∞, –¥–∞—Ç—ã —Ä–æ–∂–¥–µ–Ω–∏—è)
- ‚ùå –ü—É—Å—Ç—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (–∫–æ–≥–¥–∞ –¥–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã)

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. **–≠–∫–æ–Ω–æ–º–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤** - –Ω–µ —Ç—Ä–∞—Ç—è—Ç—Å—è –ª–∏–º–∏—Ç—ã –±–æ—Ç–∞ –Ω–∞ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
2. **–£—Å–∫–æ—Ä–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏** - –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
3. **–ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è** - —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –ø–æ–∏—Å–∫–∞
4. **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è

## –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–ü—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ñ–∞–π–ª–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è:
```
üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
‚úÖ –ù–∞–π–¥–µ–Ω–æ –¥–∞–Ω–Ω—ã—Ö: 45
üíæ –ò–∑ –∫–µ—à–∞: 30 (–≤–∫–ª—é—á–∞—è –ø—É—Å—Ç—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã)
üîç –ù–æ–≤—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫: 25
‚ùå –ë–µ–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞: 10
```

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

–ú–µ—Ç–æ–¥ `get_cached_results()` —Ç–µ–ø–µ—Ä—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –í–°–ï —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–∑ –ë–î:
```python
# –ë—ã–ª–æ (—Ç–æ–ª—å–∫–æ —Å –¥–∞–Ω–Ω—ã–º–∏):
WHERE link = ANY($1::text[]) AND found_data = TRUE

# –°—Ç–∞–ª–æ (–≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã):
WHERE link = ANY($1::text[])
```

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ

```python
# –ü–æ–ª—É—á–∞–µ–º –í–°–ï –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
cached_results = await db.get_cached_results(links)

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–æ–≤—ã–µ —Å—Å—ã–ª–∫–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
links_to_check = [link for link in links if link not in cached_results]

# –¢–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ —Å—Å—ã–ª–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –±–æ—Ç—É
if links_to_check:
    await vk_service.process_queue(links_to_check)
```

## –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. **–ü—É—Å—Ç—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ù–ï –ø–µ—Ä–µ–ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è** - –µ—Å–ª–∏ —Ä–∞–Ω–µ–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ –±—ã–ª–∏ –Ω–∞–π–¥–µ–Ω—ã, –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è
2. **–í—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è** - –¥–∞–∂–µ –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è –≤ –ë–î
3. **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** - –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ —è–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

## –ü—Ä–∏–º–µ—Ä—ã —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–µ—Ä–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞
- –§–∞–π–ª: 100 —Å—Å—ã–ª–æ–∫
- –í –ë–î: 0 —Å—Å—ã–ª–æ–∫
- –†–µ–∑—É–ª—å—Ç–∞—Ç: 100 –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –±–æ—Ç—É

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≥–æ –∂–µ —Ñ–∞–π–ª–∞
- –§–∞–π–ª: 100 —Å—Å—ã–ª–æ–∫  
- –í –ë–î: 100 —Å—Å—ã–ª–æ–∫ (60 —Å –¥–∞–Ω–Ω—ã–º–∏, 40 –±–µ–∑)
- –†–µ–∑—É–ª—å—Ç–∞—Ç: 0 –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –±–æ—Ç—É, –≤—Å–µ –∏–∑ –∫–µ—à–∞

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ß–∞—Å—Ç–∏—á–Ω–æ –Ω–æ–≤—ã–π —Ñ–∞–π–ª
- –§–∞–π–ª: 100 —Å—Å—ã–ª–æ–∫
- –í –ë–î: 70 —Å—Å—ã–ª–æ–∫ (50 —Å –¥–∞–Ω–Ω—ã–º–∏, 20 –±–µ–∑)
- –†–µ–∑—É–ª—å—Ç–∞—Ç: 30 –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –±–æ—Ç—É, 70 –∏–∑ –∫–µ—à–∞

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–æ–≥–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:
```bash
python test_cache_logic.py
```

–°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
- –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Å—Å—ã–ª–æ–∫
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—É—Å—Ç—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –æ–±—Ä–∞–±–æ—Ç–∫–∏