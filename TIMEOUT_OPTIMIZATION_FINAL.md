# –§–∏–Ω–∞–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ç–∞–π–º–∞—É—Ç–æ–≤ - 03.09.2025

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–∞–π–º–∞—É—Ç–æ–≤:

### –¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–û–ü–¢–ò–ú–ê–õ–¨–ù–´–ï):
```python
MESSAGE_TIMEOUT = 2.5  # –û—Å–Ω–æ–≤–Ω–æ–π —Ç–∞–π–º–∞—É—Ç –æ–∂–∏–¥–∞–Ω–∏—è
INITIAL_DELAY = 0.1    # –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ (100–º—Å)
RETRY_DELAY = 1.0      # –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–æ–≤—Ç–æ—Ä–∞
```

## –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã –ë–ï–ó –ü–ê–£–ó –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:

1. **–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞** ‚Üí –∂–¥–µ–º 0.1—Å (100–º—Å)
2. **–ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã** ‚Üí **–ú–ì–ù–û–í–ï–ù–ù–û –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º** ‚úÖ
3. **–ï—Å–ª–∏ –Ω–µ—Ç** ‚Üí –∂–¥–µ–º –¥–æ 2.5—Å —Å —Ç–∞–π–º–∞—É—Ç–æ–º
4. **Event —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ú–ì–ù–û–í–ï–ù–ù–û** –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö

## –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:

### –ë—ã–ª–æ (—Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è):
- –í—Å–µ–≥–¥–∞ –∂–¥–∞–ª–∏: 1.7—Å + 1.0—Å + 2.0—Å = **4.7 —Å–µ–∫—É–Ω–¥**
- –î–∞–∂–µ –ø—Ä–∏ –±—ã—Å—Ç—Ä–æ–º –æ—Ç–≤–µ—Ç–µ!

### –°—Ç–∞–ª–æ (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è):
- **–ë—ã—Å—Ç—Ä—ã–π –æ—Ç–≤–µ—Ç**: 0.1-0.5—Å (—É—Å–∫–æ—Ä–µ–Ω–∏–µ –≤ **10-40 —Ä–∞–∑!**)
- **–°—Ä–µ–¥–Ω–∏–π –æ—Ç–≤–µ—Ç**: 0.5-1.5—Å (—É—Å–∫–æ—Ä–µ–Ω–∏–µ –≤ **3-9 —Ä–∞–∑**)
- **–ú–µ–¥–ª–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç**: –¥–æ 2.6—Å (—É—Å–∫–æ—Ä–µ–Ω–∏–µ –≤ **1.8 —Ä–∞–∑–∞**)

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –ø–∞—É–∑:

```python
# –û–∂–∏–¥–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç (—Å–æ–±—ã—Ç–∏–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –ú–ì–ù–û–í–ï–ù–ù–û –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö)
try:
    # –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è —Å–∞–º—ã—Ö –±—ã—Å—Ç—Ä—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
    await asyncio.sleep(INITIAL_DELAY)  # 0.1—Å - –ø–æ—á—Ç–∏ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
    
    if not self.result_event.is_set():
        # –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –µ—â–µ –Ω–µ—Ç, –∂–¥–µ–º —Å —Ç–∞–π–º–∞—É—Ç–æ–º
        await asyncio.wait_for(self.result_event.wait(), timeout=MESSAGE_TIMEOUT)
```

–ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –≤ `_process_message`:
```python
self.current_result = self._parse_result(text)
self.result_event.set()  # ‚Üê –°–æ–±—ã—Ç–∏–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ú–ì–ù–û–í–ï–ù–ù–û!
```

## –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã:

‚úÖ **100% –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ**, –ø–æ—Ç–æ–º—É —á—Ç–æ:
- Event-driven –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω—É—é —Ä–µ–∞–∫—Ü–∏—é
- –ù–µ—Ç race conditions - –æ–¥–∏–Ω –∞–∫—Ç–∏–≤–Ω—ã–π –±–æ—Ç –Ω–∞ –∑–∞–ø—Ä–æ—Å
- –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ
- –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è –ë–ï–ó –ó–ê–î–ï–†–ñ–ï–ö

## –ü—Ä–æ–±–ª–µ–º–∞ —Å –∑–∞–ø—É—Å–∫–æ–º:
‚ö†Ô∏è `database is locked` - –ø—Ä–æ–±–ª–µ–º–∞ —Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π SQLite —Å–µ—Å—Å–∏–∏
- –ù–µ —Å–≤—è–∑–∞–Ω–æ —Å —Ç–∞–π–º–∞—É—Ç–∞–º–∏
- –¢—Ä–µ–±—É–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è (–≤–æ–∑–º–æ–∂–Ω–æ, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–π —Ç–∏–ø —Å–µ—Å—Å–∏–∏)

## –ò—Ç–æ–≥–æ–≤–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ:
üöÄ **–°—Ä–µ–¥–Ω—è—è —Å–∫–æ—Ä–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ —É–≤–µ–ª–∏—á–µ–Ω–∞ –≤ 5-10 —Ä–∞–∑!**