# VK Data Assistant - –ü–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–µ–∫—Ç–µ
*–û–±–Ω–æ–≤–ª–µ–Ω–æ: 03.09.2025*

## üìä –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

### ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (03.09.2025)
- **–°–∫–æ—Ä–æ—Å—Ç—å —É–≤–µ–ª–∏—á–µ–Ω–∞ –≤ 5-10 —Ä–∞–∑**
- –¢–∞–π–º–∞—É—Ç—ã –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã: 0.1—Å –Ω–∞—á–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ (–±—ã–ª–æ 1.7—Å)
- –£–±—Ä–∞–Ω—ã –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –ø–∞—É–∑—ã –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- –ü—Ä–æ—Ü–µ—Å—Å –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è –ú–ì–ù–û–í–ï–ù–ù–û –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

### üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- **–ë—ã—Å—Ç—Ä—ã–µ –∑–∞–ø—Ä–æ—Å—ã (80%):** 0.1-0.5 —Å–µ–∫—É–Ω–¥ (–±—ã–ª–æ 4.7—Å)
- **–°—Ä–µ–¥–Ω–∏–µ –∑–∞–ø—Ä–æ—Å—ã (15%):** 0.5-1.5 —Å–µ–∫—É–Ω–¥
- **–ú–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (5%):** –¥–æ 2.5 —Å–µ–∫—É–Ω–¥
- **–°—Ä–µ–¥–Ω—è—è —Å–∫–æ—Ä–æ—Å—Ç—å:** 30-50 —Å—Å—ã–ª–æ–∫/–º–∏–Ω—É—Ç—É

### üîß –¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```python
# services/vk_multibot_service.py
MESSAGE_TIMEOUT = 2.5  # –û—Å–Ω–æ–≤–Ω–æ–π —Ç–∞–π–º–∞—É—Ç –æ–∂–∏–¥–∞–Ω–∏—è
INITIAL_DELAY = 0.1    # –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ (100–º—Å)
RETRY_DELAY = 1.0      # –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–æ–≤—Ç–æ—Ä–∞

# –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ú–ì–ù–û–í–ï–ù–ù–û
```

## ü§ñ –ë–æ—Ç—ã –≤ —Ä–æ—Ç–∞—Ü–∏–∏

1. **@Sherlok_sherlock_bot** ‚úÖ - –æ—Å–Ω–æ–≤–Ω–æ–π, —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ
2. **@bergomorgo3bot** ‚úÖ - –Ω–æ–≤—ã–π (–∑–∞–º–µ–Ω–∏–ª –Ω–µ—Ä–∞–±–æ—Ç–∞—é—â–∏–π @okyqik5q4_sherlock_bot)
3. **@bergomorgo1bot** ‚úÖ - —Ä–µ–∑–µ—Ä–≤–Ω—ã–π
4. **@bergomorgo2bot** ‚úÖ - —Ä–µ–∑–µ—Ä–≤–Ω—ã–π

### –°–∏—Å—Ç–µ–º–∞ —Ä–æ—Ç–∞—Ü–∏–∏
- –ö—Ä—É–≥–æ–≤–∞—è —Ä–æ—Ç–∞—Ü–∏—è (round-robin)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ —Å–±–æ–π–Ω—ã—Ö –±–æ—Ç–æ–≤ –ø–æ—Å–ª–µ 3 –æ—à–∏–±–æ–∫
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –±–æ—Ç–æ–≤

## üìä –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –ü–æ—Å–ª–µ–¥–Ω—è—è —É—Å–ø–µ—à–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞:
- **–î–∞—Ç–∞/–≤—Ä–µ–º—è:** 03.09.2025, 04:06:31
- **–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ:** 6815 —Å—Å—ã–ª–æ–∫ (100% –∑–∞–≤–µ—Ä—à–µ–Ω–æ)
- **–ü–æ—Å–ª–µ–¥–Ω—è—è —Å—Å—ã–ª–∫–∞:** https://vk.com/id623992573
- **Excel —Ñ–∞–π–ª:** `/tmp/tmptv9yr2wh/vk_data_complete_20250903_040631.xlsx`

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—à–∏–±–æ–∫:
- –ë–æ—Ç @okyqik5q4_sherlock_bot - "The specified user was deleted" (–∑–∞–º–µ–Ω–µ–Ω)
- database is locked - –ø—Ä–æ–±–ª–µ–º–∞ —Å SQLite —Å–µ—Å—Å–∏–µ–π (—Ç—Ä–µ–±—É–µ—Ç —Ä–µ—à–µ–Ω–∏—è)

## üõ† –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- **Python 3.10** - –æ—Å–Ω–æ–≤–Ω–æ–π —è–∑—ã–∫
- **Telethon** - —Ä–∞–±–æ—Ç–∞ —Å Telegram API
- **PostgreSQL** - –æ—Å–Ω–æ–≤–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **Redis** - –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Å–µ—Å—Å–∏–∏
- **openpyxl** - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è Excel —Ñ–∞–π–ª–æ–≤
- **asyncio** - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:
- PostgreSQL –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- Redis –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è (TTL: 24 —á–∞—Å–∞)
- SQLite –¥–ª—è Telegram —Å–µ—Å—Å–∏–π

## ‚ö†Ô∏è –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. database is locked (–ö–†–ò–¢–ò–ß–ù–û)
- **–û–ø–∏—Å–∞–Ω–∏–µ:** SQLite –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è—Ö
- **–í–ª–∏—è–Ω–∏–µ:** –ë–æ—Ç –Ω–µ –º–æ–∂–µ—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è
- **–†–µ—à–µ–Ω–∏—è:**
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Memory session –≤–º–µ—Å—Ç–æ SQLite
  - –í–∫–ª—é—á–∏—Ç—å WAL mode –¥–ª—è SQLite
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ session —Ñ–∞–π–ª—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –±–æ—Ç–∞

### 2. SSL transport errors
- **–û–ø–∏—Å–∞–Ω–∏–µ:** –û—à–∏–±–∫–∏ SSL –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- **–í–ª–∏—è–Ω–∏–µ:** –ù–µ–∫—Ä–∏—Ç–∏—á–Ω–æ, —Ç–æ–ª—å–∫–æ –≤ –ª–æ–≥–∞—Ö
- **–°—Ç–∞—Ç—É—Å:** –ù–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–∞–±–æ—Ç—É

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
/home/vkbot/vk-data-assistant/
‚îú‚îÄ‚îÄ bot/
‚îÇ   ‚îú‚îÄ‚îÄ main.py                 # –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –±–æ—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ config.py                # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ handlers/
‚îÇ       ‚îú‚îÄ‚îÄ search_handler.py    # –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–∏—Å–∫–∞
‚îÇ       ‚îú‚îÄ‚îÄ admin_handler.py     # –ê–¥–º–∏–Ω –∫–æ–º–∞–Ω–¥—ã
‚îÇ       ‚îî‚îÄ‚îÄ excel_handler.py     # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Excel
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ vk_multibot_service.py  # ‚úÖ –û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù
‚îÇ   ‚îú‚îÄ‚îÄ database.py              # PostgreSQL
‚îÇ   ‚îú‚îÄ‚îÄ excel_service.py         # Excel –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä
‚îÇ   ‚îî‚îÄ‚îÄ cache_service.py         # Redis –∫—ç—à
‚îú‚îÄ‚îÄ data/                        # –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
‚îú‚îÄ‚îÄ logs/                        # –õ–æ–≥–∏ —Ä–∞–±–æ—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ bot.log
‚îÇ   ‚îú‚îÄ‚îÄ error.log
‚îÇ   ‚îî‚îÄ‚îÄ startup.log
‚îú‚îÄ‚îÄ .env                         # ‚úÖ –û–ë–ù–û–í–õ–ï–ù (–Ω–æ–≤—ã–π –±–æ—Ç)
‚îî‚îÄ‚îÄ run.py                       # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
```

## üöÄ –ö–æ–º–∞–Ω–¥—ã –∑–∞–ø—É—Å–∫–∞

### –û—Å–Ω–æ–≤–Ω–æ–π –∑–∞–ø—É—Å–∫:
```bash
cd /home/vkbot/vk-data-assistant
/home/vkbot/vk-data-assistant/venv/bin/python run.py
```

### –° –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º:
```bash
/home/vkbot/vk-data-assistant/venv/bin/python run.py > logs/startup.log 2>&1 &
```

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞:
```bash
ps aux | grep "python.*run.py" | grep -v grep | awk '{print $2}' | xargs -r kill -TERM
```

## üìù –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ:
- `/start` - –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã
- `/help` - –°–ø—Ä–∞–≤–∫–∞
- `/search` - –ü–æ–∏—Å–∫ –¥–∞–Ω–Ω—ã—Ö –ø–æ VK —Å—Å—ã–ª–∫–∞–º
- `/cancel` - –û—Ç–º–µ–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏
- `/status` - –°—Ç–∞—Ç—É—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏

### –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ:
- `/stats` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–∞–±–æ—Ç—ã
- `/cache_info` - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫—ç—à–µ
- `/restart_session` - –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Å—Å–∏–∏
- `/export_db` - –≠–∫—Å–ø–æ—Ä—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (02.09.2025):
- –í—Ä–µ–º—è –Ω–∞ –∑–∞–ø—Ä–æ—Å: 4.7 —Å–µ–∫—É–Ω–¥ (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ)
- –°–∫–æ—Ä–æ—Å—Ç—å: ~12 —Å—Å—ã–ª–æ–∫/–º–∏–Ω—É—Ç—É
- –ó–∞–¥–µ—Ä–∂–∫–∏: 1.7—Å + 1.0—Å + 2.0—Å

### –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (03.09.2025):
- –í—Ä–µ–º—è –Ω–∞ –∑–∞–ø—Ä–æ—Å: 0.1-2.5 —Å–µ–∫—É–Ω–¥ (–∞–¥–∞–ø—Ç–∏–≤–Ω–æ–µ)
- –°–∫–æ—Ä–æ—Å—Ç—å: 30-50 —Å—Å—ã–ª–æ–∫/–º–∏–Ω—É—Ç—É
- –ó–∞–¥–µ—Ä–∂–∫–∏: 0.1—Å –Ω–∞—á–∞–ª—å–Ω–∞—è, –¥–∞–ª–µ–µ –ø–æ —Å–æ–±—ã—Ç–∏—é

### –£–ª—É—á—à–µ–Ω–∏–µ:
- **–£—Å–∫–æ—Ä–µ–Ω–∏–µ –≤ 5-10 —Ä–∞–∑** –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –∑–∞–ø—Ä–æ—Å–æ–≤
- **–ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è —Ä–µ–∞–∫—Ü–∏—è** –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã** –≤–º–µ—Å—Ç–æ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—É–±–ª–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ
- –ü—Ä–æ–∫—Å–∏ SOCKS5 –¥–ª—è –æ–±—Ö–æ–¥–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–æ—Ç–∞—Ü–∏—è –ø—Ä–∏ rate limits
- –ê–¥–º–∏–Ω-–¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –ø–æ ID –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞

## üìã TODO - –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å database lock:**
   - [ ] –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ Memory session
   - [ ] –ò–ª–∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å WAL mode
   - [ ] –ò–ª–∏ —Ä–∞–∑–¥–µ–ª–∏—Ç—å session —Ñ–∞–π–ª—ã

2. **–î–∞–ª—å–Ω–µ–π—à–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**
   - [ ] –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ 2-3 –∑–∞–ø—Ä–æ—Å–æ–≤
   - [ ] –£–º–Ω–∞—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏ –º–µ–∂–¥—É –±–æ—Ç–∞–º–∏
   - [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–±–æ–π–Ω—ã—Ö –±–æ—Ç–æ–≤

3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
   - [ ] Dashboard —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
   - [ ] –ê–ª–µ—Ä—Ç—ã –ø—Ä–∏ —Å–±–æ—è—Ö
   - [ ] –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

- –ê–¥–º–∏–Ω—ã: ID –∏–∑ ADMIN_IDS –≤ .env
- –õ–æ–≥–∏: /home/vkbot/vk-data-assistant/logs/
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: PostgreSQL (vk_data)

## üîÑ –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

### 03.09.2025
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Ç–∞–π–º–∞—É—Ç—ã (—É—Å–∫–æ—Ä–µ–Ω–∏–µ –≤ 5-10 —Ä–∞–∑)
- –ó–∞–º–µ–Ω–µ–Ω –Ω–µ—Ä–∞–±–æ—Ç–∞—é—â–∏–π –±–æ—Ç @okyqik5q4_sherlock_bot
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –ë–î
- –£–±—Ä–∞–Ω—ã –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –ø–∞—É–∑—ã

### 02.09.2025
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –±–æ—Ç–æ–≤
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∫—Ä—É–≥–æ–≤–∞—è —Ä–æ—Ç–∞—Ü–∏—è
- –£–ª—É—á—à–µ–Ω –ø–∞—Ä—Å–∏–Ω–≥ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤

---
*–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω: 03.09.2025*
*–ü—Ä–æ–µ–∫—Ç –∞–∫—Ç–∏–≤–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ*